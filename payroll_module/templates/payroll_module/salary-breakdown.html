{% extends 'nexus/layout.html' %}
{% load static %}
{% block title %}
Salary Breakdown
{% endblock title %}
{% block breadcrumbs %}
    <span class="kt-subheader__separator kt-hidden"></span>
    <div class="kt-subheader__breadcrumbs">
        <a href="{% url 'dashboard' %}" class="kt-subheader__breadcrumbs-home"><i class="flaticon2-shelter"></i></a>
        <span class="kt-subheader__breadcrumbs-separator"></span>
        <a href="" class="kt-subheader__breadcrumbs-link">
            Payroll </a>
        <span class="kt-subheader__breadcrumbs-separator"></span>
        <a href="" class="kt-subheader__breadcrumbs-link">
            Breakdowns </a>
    </div>
{% endblock breadcrumbs %}
{% block content %}
<script>
    $(function() {
        var csrftoken = Cookies.get('csrftoken');
        function csrfSafeMethod(method) {
            // these HTTP methods do not require CSRF protection
            return (/^(GET|HEAD|OPTIONS|TRACE)$/.test(method));
        }
        $.ajaxSetup({
            beforeSend: function(xhr, settings) {
                if (!csrfSafeMethod(settings.type) && !this.crossDomain) {
                    xhr.setRequestHeader("X-CSRFToken", csrftoken);
                }
            }
        });

        var dtopt = {
            "searching": false,
            "paging": false,
            "info": false,
            "initComplete": function() {
                $(document).on('click', '#DataTables_Table_0 tbody tr', function() {
                    id = $(this).attr('id');
                    console.log('clicked on row -> id ' + id)
                    $.ajax({
                        type: 'GET',
                        url: "{% url 'get-salary' %}",
                        data: {'s_id': id},
                        success: function (response) {
                            $('#details').show()
                            print_details(response)
                        }
                    });
                });
            }
        };
        var dt = datatableview.initialize($('.datatable'), dtopt);
        var table = dt.api();
        $('.datatable').addClass("ui celled table")

        function print_details(response) {
            $('#check_month').text(response.month)
            $('#a_pay').text(response.total)
        }
    });
</script>
<div class="kt-content kt-grid__item kt-grid__item--fluid" id="kt_content">
    <div class='row'>
        <div class='col-sm-6'>
            <div class='kt-portlet'>
                <div class='kt-portlet__body'>
                    {{ datatable }}
                </div>
            </div>
        </div>
        <div class='col-sm-6' id='details' style='display: none;'>
            <div class='kt-portlet'>
                <div class='kt-portlet__body'>
                    <!-- <h1 id='check_month'></h1> -->
                    <div class='kt-widget-2'>
                        <div class='kt-widget-2__content kt-portlet__space-x' style='padding: 0px !important;'>
                            <div class='row'>
                                <div class='col'>
                                    <div class="kt-widget-2__item" style="margin-top: 1.4rem !important;">
                                        <div class="kt-widget-2__item-stats">
                                            <div class="kt-widget-2__item-info">
                                                <h6 class="kt-widget-2__item-text">Total</h6>
                                            </div>
                                        </div>
                                        <div class="kt-widget-2__item-title" id='a_pay' style='font-size: 3rem !important;'></div>
                                        
                                    </div>
                                </div>
                            </div>                            
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

{% endblock content %}